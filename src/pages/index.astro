---
import BaseLayout from '@/layouts/BaseLayout.astro';
import PostCard from '@/components/PostCard.astro';
import Search from '@/components/Search.astro';
import { getCollection } from 'astro:content';

// Get all published blog posts, sorted by publication date (newest first)
const allPosts = await getCollection('blog', ({ data }) => {
  return data.draft !== true;
});

const sortedPosts = allPosts.sort(
  (a, b) => new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf()
);

// Get the 5 most recent posts for the homepage
const recentPosts = sortedPosts.slice(0, 5);
---

<BaseLayout title="My Astro Blog">
  <!-- Hero Section -->
  <section class="text-center mb-12">
    <h1 class="text-4xl md:text-6xl font-bold text-white mb-4">
      Welcome to My Blog
    </h1>
    <p class="text-xl text-zinc-400 mb-8 max-w-2xl mx-auto">
      Thoughts, guides, and notes about web development, technology, and life.
    </p>
    
    <!-- Search Component -->
    <div class="max-w-md mx-auto mb-8">
      <Search placeholder="Search all posts..." />
    </div>
    
    <div class="flex justify-center gap-4">
      <a 
        href="/blog" 
        class="bg-white text-zinc-900 px-6 py-3 rounded-lg font-semibold hover:bg-zinc-200 transition-colors duration-200"
      >
        View All Posts
      </a>
      <a 
        href="/about" 
        class="border border-zinc-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-zinc-800 transition-colors duration-200"
      >
        About Me
      </a>
    </div>
  </section>
  
  <!-- Recent Posts Section -->
  {recentPosts.length > 0 && (
    <section>
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-3xl font-bold text-white">Recent Posts</h2>
        <a 
          href="/blog" 
          class="text-zinc-400 hover:text-white transition-colors duration-200 flex items-center gap-2"
        >
          View all posts ‚Üí
        </a>
      </div>
      
      <ul class="space-y-6">
        {recentPosts.map((post) => (
          <PostCard
            href={`/blog/${post.slug}`}
            title={post.data.title}
            description={post.data.description}
            date={post.data.pubDate}
            tags={post.data.tags}
          />
        ))}
      </ul>
    </section>
  )}
  
  <!-- Empty State -->
  {recentPosts.length === 0 && (
    <section class="text-center py-12">
      <div class="text-6xl mb-4">üìù</div>
      <h2 class="text-2xl font-semibold text-white mb-4">No posts yet</h2>
      <p class="text-zinc-400 mb-8">
        This blog is just getting started. Check back soon for new content!
      </p>
      <a 
        href="/about" 
        class="text-blue-400 hover:text-blue-300 underline transition-colors"
      >
        Learn more about this blog
      </a>
    </section>
  )}
  
  <!-- Newsletter/RSS Section -->
  <section class="mt-16 pt-8 border-t border-zinc-800 text-center">
    <h3 class="text-xl font-semibold text-white mb-4">Stay Updated</h3>
    <p class="text-zinc-400 mb-6">
      Subscribe to the RSS feed to get notified when new posts are published.
    </p>
    <a 
      href="/rss.xml" 
      class="inline-flex items-center gap-2 bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors duration-200"
    >
      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
        <path d="M3.429 2.571c8.571 0 15.429 6.857 15.429 15.429h-3.429c0-6.857-5.714-12.571-12.571-12.571v-2.857zM3.429 7.429c5.714 0 10.286 4.571 10.286 10.286h-3.429c0-3.714-3.143-6.857-6.857-6.857v-3.429zM6.857 15.429c0 1.143-0.857 2-2 2s-2-0.857-2-2 0.857-2 2-2 2 0.857 2 2z"></path>
      </svg>
      RSS Feed
    </a>
  </section>
</BaseLayout>